This repository contains a modified form of a few of the sample codes from [Cuda for Engineers](http://www.cudaforengineers.com), modified to use CMake for generating build environments.

To run, you will need the NVIDIA CUDA Toolkit and an appropriate (CUDA-compatible) compiler for your OS.

Windows binaries (maybe only VS 2013 binaries), libraries, and headers for [FreeGLUT](http://www.transmissionzero.co.uk/software/freeglut-devel/), and [GLEW](glew.sourceforge.net) are also included for your convenience. Those files are covered by the license agreements of their respective projects.

##To Build
This project uses CMake to create project files that will work on your compiler across platforms. Follow the instructions for your OS below.

##Installation and Compilation on Windows

###Build Tools
Download the binary installer for [CMake](http://cmake.org) and install. For compilation, it's assumed you have a version of CUDA and Visual Studio installed and working (i.e. the CUDA samples compile and run).

###Libraries
Windows binaries for FreeGLUT and GLEW are included in this repository. In future versions of Visual Studio, compatibility with these binaries may break. In that case, acquire and possibly build new binaries for [FreeGLUT](http://www.transmissionzero.co.uk/software/freeglut-devel/), and [GLEW](glew.sourceforge.net).

FreeGLUT and GLEW are only required for projects involving OpenGL interoperability.

###Creating Build Environment and Compiling
Open the CMake GUI from the Start Menu, then follow these steps:
* Click the "Browse Source..." button and navigate to the folder containing your CMakeLists.txt
* Copy the "source code" path from the top line and paste it into the second line ("where to build the binaries"), then append "/bin"
* Click the Configure button (in the bottom left)
 * In the dialog that appears, select your compiler of choice. For CUDA compatibility on Windows, you must use a version of Visual Studio, and Win64 is preferred if not required by the tool chain. For example, I use "Visual Studio 12 2013 Win64"
 * Click Finish to accept all other options
* It will think for a bit; if any errors appear, a dialog will notify you and the log at the bottom of the window will give details. Red highlighted lines in the center of the window are NOT ERRORS.
* Click the Generate button to create the Visual Studio project.
* Click the Open Project button to open Visual Studio and use it to compile your code.

Once you have done this once, you do NOT need to use the CMake GUI to re-generate the project if you edit your CMakeLists.txt unless you want to change versions of Visual Studio or do other fun things not discussed here.

__Note:__ When working with Visual Studio solutions generated by CMake, there are three virtual projects created, all opened simultaneously. `ZERO_CHECK` is a dummy project which checks if CMakeLists has been changed and rebuilds the project as needed. It should never contain code files and doesn't compile anything. `ALL_BUILD` is a dummy project which builds all other projects (similar to `make all`) and is generally not used. The third project has a name specified in your CMakeLists.txt file and contains your code. You must make this project the "Start Up" project so Visual Studio knows which one to run. To do this, right click on your project in the Solution Explorer window and select "Set as Start Up Project" from the menu. This will turn the project title bold-face

Use Build->Build All to compile your code. Occasionally, especially at first or after you have changed your CMakeLists.txt file, a dialog may appear asking you if you want to reload the project because it has been changed by another program. Click "Reload All" when this happens.


##Installation and Compilation on Ubuntu

###Build Tools
install git - `sudo apt-get install git` (already on Ubuntu)

install cmake - `sudo apt-get install cmake` (already on Ubuntu) and `sudo apt-get install cmake-curses-gui`

###Libraries
The following libraries are required for all projects using OpenGL interoperability.

`sudo apt-get install freeglut3-dev`

`sudo apt-get install libglew-dev`

`sudo apt-get install libxi-dev`

`sudo apt-get install libxmu-dev`

`sudo apt-get install libglew1.13`

###Creating a Build Environment and Compiling
Start a terminal in the sample folder (this folder contains CMakeLists.txt) and create a subdirectory named `bin`. Change to this new directory and execute `ccmake ../` to enter the terminal-based CMake GUI.
* Press "c" to configure. Hopefully no errors occur
* Press "Enter" on the `CMAKE_BUILD_TYPE` field and type Release or Configure to specify the build type you wish.
* Press "g" to generate the build files

To compile, use `make` in the `bin` directory.

If you don't want to use the terminal GUI, you can specify the build type, configure, and generate the build files using the following command line:

~~~
path/to/project/bin$cmake -DCMAKE_BUILD_TYPE=Release ..
~~~

The CMake screen should appear. Press "c" to configure. To specify the build type (debug/release), press "Enter" on the `CMAKE_BUILD_TYPE` field and type `Debug` or `Release`, as you wish. Then use "g" to generate the makefile and exit.

Now we'll run make to compile the source into an executable, linked with GLEW, GLUT, and GLUI.

~~~
make
~~~

If it worked, an executable file should appear.

## Working with Eclipse
References: [official wiki](https://cmake.org/Wiki/Eclipse_CDT4_Generator), [tip I needed](http://stackoverflow.com/questions/11645575/importing-a-cmake-project-into-eclipse-cdt)

First, Eclipse doesn't like your CMake Project Name and Binary Name to be the same, so in the first few lines of CMakeLists.txt, change either the `project()` or `set(EXE_NAME ...)` calls so they are not the same.

Build a CMake project for Eclipse using

~~~
path/to/flashlight$ cmake -G "Eclipse CDT4 - Unix Makefiles" .
~~~

Note two things: First, Eclipse really wants its project files to be at the root of the source tree, so we *don't* use a bin subfolder this time. Second, the indication that this worked is the presence of *hidden* ".project" and ".cproject" files in the working directory; use `ls -a` to check whether they were created.

Now, open Eclipse and go to File->Import. You want General->Existing Projects Into Workspace. On the next screen, navigate to the source directory and *important* Uncheck the Copy Projects Into Workspace checkbox (otherwise, building within Eclipse fails).

This seems to work with Eclipse NSight Edition version 8.

## Converting other samples (or your own project) to CMake

### Prerequisites

[CMake](https://cmake.org/) is a cross-platform tool for managing platform-specific builds for your code. The same CMake configuration file can be used to create a makefile on Linux and a Visual Studio project on Windows, for example. These instructions assume you already have CMake installed on your platform. On Linux, this tutorial assumes you have also installed the command line GUI, ccmake (`apt-get install cmake-curses-gui`)

### Files and Directories

The provided CMake configuration files assume the source files are separate from the generated build files and output binary files. This makes everything cleaner, but requires a bit of reorganization of the sample code provided in the original repository.

First, move all the source code into a new subdirectory named "src". Then, delete the Visual Studio solution (.sln) and project (.vcxproj) as well as the Makefile. After this step, there should be only one folder in the project, named "src" and no other files.

The CMake build scripts we have created rely explicitly on two directories external to the project: `libs` and `include`. `libs` contains several useful CMake scripts for locating and configuring various libraries, as well as binaries for FreeGLUT and GLEW on Windows (provided because of Windows' lack of a package manager). `include` contains a few header files which should be included in all projects.

### Selecting and Setting Up a CMakeLists.txt

The CMake build rules are stored in a special file called CMakeLists.txt. We have provided several template CMakeLists.txt, depending on which dependencies are required for your project. Go select a CMakeLists.txt file from one of the subfolders in this repository according to your needs:

* CUDA development only: `dist_v1_cuda/CMakeLists.txt`
* CUDA + OpenGL Interop (GLEW, GLUT): `vis_3d/CMakeLists.txt`

Copy the appropriate CMakeLists.txt file into the root folder of your current project. Open it in your favorite text editor and find the lines near the top which read:

~~~
project(dist_v1_cuda)
set(EXE_NAME dist_v1_cuda)
~~~

Change `dist_v1_cuda` to match the name of your current project on both lines and save the file.

### Configuring and Generating using CMake

Follow the instructions given above, depending on your OS.

##Errata
Tweaks by Ben Weiss; original source by Duane Storti and Mete Yyurtoglu.